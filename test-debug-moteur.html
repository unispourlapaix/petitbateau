<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Debug Moteur Kawaii</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #001122;
            color: white;
        }
        .debug {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .error { border-color: #ff4444; background: rgba(255,68,68,0.1); }
        .success { border-color: #44ff44; background: rgba(68,255,68,0.1); }
        .warning { border-color: #ffff44; background: rgba(255,255,68,0.1); }
        button {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        .container {
            width: 600px;
            height: 300px;
            border: 2px solid #666;
            margin: 20px 0;
            position: relative;
            background: rgba(0,50,100,0.2);
        }
    </style>
</head>
<body>
    <h1>🔧 Debug Moteur Kawaii Objects</h1>

    <button onclick="testFullSystem()">🚀 Test Complet</button>
    <button onclick="testBanana()">🍌 Test Banane</button>
    <button onclick="clearAll()">🧹 Clear</button>

    <div class="container" id="container"></div>

    <div id="debugLog"></div>

    <script src="modules/kawaii_objects_module.js"></script>
    <script>
        const debugLog = document.getElementById('debugLog');
        const container = document.getElementById('container');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugLog.appendChild(div);
            console.log(message);
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        // Capturer les erreurs
        window.addEventListener('error', function(e) {
            log(`❌ ERREUR: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });

        function testFullSystem() {
            log('🚀 DÉBUT TEST COMPLET', 'warning');

            // Test 1: Module disponible
            if (typeof KawaiiObjects === 'undefined') {
                log('❌ KawaiiObjects non disponible', 'error');
                return;
            }
            log('✅ Module KawaiiObjects disponible', 'success');

            // Test 2: Création instance
            let kawaii;
            try {
                kawaii = new KawaiiObjects();
                log('✅ Instance créée avec succès', 'success');
            } catch (e) {
                log(`❌ Erreur création instance: ${e.message}`, 'error');
                return;
            }

            // Test 3: CSS
            try {
                const css = kawaii.getCSS();
                if (css && css.length > 100) {
                    log(`✅ CSS généré (${css.length} caractères)`, 'success');

                    // Injecter CSS
                    const style = document.createElement('style');
                    style.textContent = css;
                    document.head.appendChild(style);
                    log('✅ CSS injecté', 'success');
                } else {
                    log('❌ CSS invalide ou vide', 'error');
                }
            } catch (e) {
                log(`❌ Erreur CSS: ${e.message}`, 'error');
            }

            // Test 4: Liste objets
            try {
                const objects = kawaii.getObjectsList();
                log(`✅ ${objects.length} types d'objets disponibles:`, 'success');
                objects.forEach(obj => {
                    log(`  - ${obj.id}: ${obj.name} (${obj.type})`, 'info');
                });
            } catch (e) {
                log(`❌ Erreur liste objets: ${e.message}`, 'error');
            }

            // Test 5: Création objets
            const types = ['banane', 'baleine', 'tank', 'asteroide'];
            types.forEach((type, index) => {
                try {
                    const obj = kawaii.createObject(type, 50 + index * 100, 50);
                    if (obj && obj.element) {
                        container.appendChild(obj.element);
                        log(`✅ ${type} créé avec ID: ${obj.id}`, 'success');
                    } else {
                        log(`❌ ${type} création échec`, 'error');
                    }
                } catch (e) {
                    log(`❌ Erreur création ${type}: ${e.message}`, 'error');
                }
            });

            log('🏁 TEST COMPLET TERMINÉ', 'warning');
        }

        function testBanana() {
            log('🍌 TEST SPÉCIFIQUE BANANE', 'warning');

            if (typeof KawaiiObjects === 'undefined') {
                log('❌ Module non disponible', 'error');
                return;
            }

            const kawaii = new KawaiiObjects();

            // Injecter CSS si pas déjà fait
            if (!document.getElementById('kawaii-css')) {
                const style = document.createElement('style');
                style.id = 'kawaii-css';
                style.textContent = kawaii.getCSS();
                document.head.appendChild(style);
            }

            // Créer banane
            const banane = kawaii.createObject('banane', 200, 100);
            if (banane && banane.element) {
                container.appendChild(banane.element);
                log(`✅ Banane créée: ${banane.id}`, 'success');

                // Vérifier styles appliqués
                const computed = window.getComputedStyle(banane.element);
                log(`📊 Styles banane:`, 'info');
                log(`  - Width: ${computed.width}`, 'info');
                log(`  - Height: ${computed.height}`, 'info');
                log(`  - Background: ${computed.backgroundColor}`, 'info');
                log(`  - Transform: ${computed.transform}`, 'info');
            } else {
                log('❌ Échec création banane', 'error');
            }
        }

        function clearAll() {
            container.innerHTML = '';
            debugLog.innerHTML = '';
            log('🧹 Tout nettoyé', 'info');
        }

        // Auto-test au chargement
        window.addEventListener('load', () => {
            log('📋 Page chargée - Prêt pour debug', 'info');
        });
    </script>
</body>
</html>