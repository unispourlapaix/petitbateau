<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mobile - La Quête de Vérité</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.4;
        }
        .error { color: #ff4444; background: rgba(255,68,68,0.1); padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { color: #44ff44; background: rgba(68,255,68,0.1); padding: 10px; margin: 5px 0; border-radius: 5px; }
        .info { color: #4444ff; background: rgba(68,68,255,0.1); padding: 10px; margin: 5px 0; border-radius: 5px; }
        .warning { color: #ffaa00; background: rgba(255,170,0,0.1); padding: 10px; margin: 5px 0; border-radius: 5px; }
        #log { max-height: 70vh; overflow-y: auto; border: 1px solid #333; padding: 10px; margin-bottom: 20px; }
        canvas { border: 2px solid #444; display: block; margin: 10px 0; background: white; }
        button { background: #333; color: #00ff00; border: 1px solid #666; padding: 10px 15px; margin: 5px; cursor: pointer; }
        button:hover { background: #444; }
    </style>
</head>
<body>
    <h1>🐛 Debug Mobile - La Quête de Vérité</h1>
    <button onclick="testBasicFunctionality()">🧪 Test Basique</button>
    <button onclick="testModuleImports()">📦 Test Modules</button>
    <button onclick="testCanvas()">🎨 Test Canvas</button>
    <button onclick="clearLog()">🗑️ Clear Log</button>
    
    <div id="log"></div>
    <canvas id="testCanvas" width="300" height="200"></canvas>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            log.innerHTML = '';
        }

        function testBasicFunctionality() {
            addLog('🚀 Début des tests de base...', 'info');
            
            // Test 1: Canvas disponible
            const canvas = document.getElementById('testCanvas');
            if (canvas) {
                addLog('✅ Canvas trouvé', 'success');
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    addLog('✅ Contexte 2D obtenu', 'success');
                    
                    // Test de dessin simple
                    ctx.fillStyle = '#74b9ff';
                    ctx.fillRect(10, 10, 100, 50);
                    ctx.fillStyle = 'white';
                    ctx.font = '16px sans-serif';
                    ctx.fillText('Test OK', 20, 35);
                    addLog('✅ Dessin de test réussi', 'success');
                } else {
                    addLog('❌ Impossible d\'obtenir le contexte 2D', 'error');
                }
            } else {
                addLog('❌ Canvas non trouvé', 'error');
            }

            // Test 2: Support ES6 modules
            if (typeof import === 'undefined') {
                addLog('❌ Support ES6 modules manquant', 'error');
            } else {
                addLog('✅ Support ES6 modules disponible', 'success');
            }

            // Test 3: APIs mobiles
            addLog('📱 Tests APIs mobiles:', 'info');
            addLog(`Touch: ${'ontouchstart' in window ? '✅' : '❌'}`, 'info');
            addLog(`Vibration: ${'vibrate' in navigator ? '✅' : '❌'}`, 'info');
            addLog(`DevicePixelRatio: ${window.devicePixelRatio || 1}`, 'info');
            addLog(`Screen: ${screen.width}x${screen.height}`, 'info');
            addLog(`Viewport: ${window.innerWidth}x${window.innerHeight}`, 'info');
        }

        function testModuleImports() {
            addLog('📦 Test des imports de modules...', 'info');
            
            const modules = [
                './js/main.js',
                './js/mobile-adapter.js',
                './js/modules/game.js',
                './js/modules/angel.js',
                './js/modules/orb.js',
                './js/modules/buildings.js',
                './js/modules/rpg.js',
                './js/modules/ui.js'
            ];

            let successCount = 0;
            let errorCount = 0;

            modules.forEach((modulePath, index) => {
                import(modulePath)
                    .then((module) => {
                        successCount++;
                        addLog(`✅ ${modulePath} - Chargé avec succès`, 'success');
                        if (module.default) {
                            addLog(`   └─ Export par défaut: ${typeof module.default}`, 'info');
                        }
                        Object.keys(module).forEach(exportName => {
                            if (exportName !== 'default') {
                                addLog(`   └─ Export: ${exportName} (${typeof module[exportName]})`, 'info');
                            }
                        });
                        
                        if (successCount + errorCount === modules.length) {
                            addLog(`📊 Résultats: ${successCount} succès, ${errorCount} erreurs`, successCount === modules.length ? 'success' : 'warning');
                        }
                    })
                    .catch((error) => {
                        errorCount++;
                        addLog(`❌ ${modulePath} - Erreur: ${error.message}`, 'error');
                        addLog(`   └─ Stack: ${error.stack}`, 'error');
                        
                        if (successCount + errorCount === modules.length) {
                            addLog(`📊 Résultats: ${successCount} succès, ${errorCount} erreurs`, successCount === modules.length ? 'success' : 'warning');
                        }
                    });
            });
        }

        function testCanvas() {
            addLog('🎨 Test avancé du Canvas...', 'info');
            
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            if (!ctx) {
                addLog('❌ Pas de contexte Canvas', 'error');
                return;
            }

            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            try {
                // Test gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                gradient.addColorStop(0, '#74b9ff');
                gradient.addColorStop(1, '#a29bfe');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                addLog('✅ Gradient linéaire OK', 'success');

                // Test radial gradient
                const radialGrad = ctx.createRadialGradient(150, 100, 0, 150, 100, 50);
                radialGrad.addColorStop(0, 'white');
                radialGrad.addColorStop(1, 'transparent');
                ctx.fillStyle = radialGrad;
                ctx.fillRect(100, 50, 100, 100);
                addLog('✅ Gradient radial OK', 'success');

                // Test paths
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(75, 100, 30, 0, Math.PI * 2);
                ctx.stroke();
                addLog('✅ Chemins et arcs OK', 'success');

                // Test text
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Canvas Test', 150, 180);
                addLog('✅ Rendu texte OK', 'success');

                // Test image smoothing
                ctx.imageSmoothingEnabled = false;
                ctx.fillStyle = 'red';
                ctx.fillRect(220, 80, 10, 10);
                ctx.scale(2, 2);
                ctx.fillRect(225, 85, 5, 5);
                ctx.setTransform(1, 0, 0, 1, 0, 0); // Reset transform
                addLog('✅ Image smoothing control OK', 'success');

            } catch (error) {
                addLog(`❌ Erreur Canvas: ${error.message}`, 'error');
            }
        }

        // Auto-run basic tests
        setTimeout(() => {
            addLog('🎯 Démarrage automatique des tests...', 'info');
            testBasicFunctionality();
        }, 500);

        // Error handlers
        window.addEventListener('error', (event) => {
            addLog(`❌ Erreur JavaScript globale: ${event.message}`, 'error');
            addLog(`   └─ Fichier: ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            addLog(`❌ Promesse rejetée: ${event.reason}`, 'error');
        });

        // Mobile-specific tests
        if ('ontouchstart' in window) {
            addLog('📱 Appareil tactile détecté', 'info');
            
            document.addEventListener('touchstart', (e) => {
                addLog(`👆 Touch start: ${e.touches.length} doigt(s)`, 'info');
            }, { once: true });
        }
    </script>
</body>
</html>