<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Typewriter</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }
        #message {
            border: 1px solid #64ffda;
            padding: 20px;
            margin: 20px 0;
            background: rgba(0,0,0,0.5);
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            background: #64ffda;
            border: none;
            color: black;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Test Module Animation Typewriter</h1>
    <div id="message"></div>

    <button onclick="testTypewriter()">Test Typewriter</button>
    <button onclick="testFade()">Test Fade</button>
    <button onclick="testDigital()">Test Digital</button>

    <script>
        // Module d'Animation de Texte - Version compl√®te avec support HTML
        class TextAnimationModule {
            constructor() {
                this.isRunning = false;
                this.isPaused = false;
                this.currentIndex = 0;
                this.timeoutId = null;
                this.text = '';
                this.options = {};
            }

            // Arr√™te l'animation
            stop() {
                this.isRunning = false;
                this.isPaused = false;
                if (this.timeoutId) {
                    clearTimeout(this.timeoutId);
                }
            }

            // Reset
            reset() {
                this.stop();
                this.currentIndex = 0;
                this.text = '';
            }

            // Animation machine √† √©crire avec support HTML complet
            typewriter(element, text, speed = 50, onComplete = null) {
                console.log('Typewriter called with:', { text, speed });
                this.text = text;
                this.options = {
                    speed: speed,
                    onComplete: onComplete
                };

                this.reset();
                element.innerHTML = '';
                element.style.borderRight = '2px solid #64ffda';
                this.isRunning = true;

                this._typewriterStep(element);
            }

            _typewriterStep(element) {
                if (!this.isRunning) return;

                if (this.currentIndex < this.text.length) {
                    let currentChar = this.text.charAt(this.currentIndex);

                    if (currentChar === '<') {
                        let tagEnd = this.text.indexOf('>', this.currentIndex);
                        if (tagEnd !== -1) {
                            let fullTag = this.text.substring(this.currentIndex, tagEnd + 1);
                            element.innerHTML += fullTag;
                            this.currentIndex = tagEnd + 1;
                        } else {
                            element.innerHTML += currentChar;
                            this.currentIndex++;
                        }
                    } else if (currentChar === '\n') {
                        element.innerHTML += '<br>';
                        this.currentIndex++;
                    } else {
                        element.innerHTML += currentChar;
                        this.currentIndex++;
                    }

                    this.timeoutId = setTimeout(() => this._typewriterStep(element), this.options.speed);
                } else {
                    element.style.borderRight = 'none';
                    this.isRunning = false;
                    if (this.options.onComplete) this.options.onComplete();
                }
            }

            // Animation fade
            fadeIn(element, text, duration = 1000, onComplete = null) {
                console.log('Fade called with:', { text, duration });
                this.reset();
                element.innerHTML = text.replace(/\n/g, '<br>');
                element.style.opacity = '0';
                element.style.transition = `opacity ${duration}ms ease-in`;

                setTimeout(() => {
                    element.style.opacity = '1';
                }, 50);

                setTimeout(() => {
                    element.style.transition = '';
                    if (onComplete) onComplete();
                }, duration);
            }

            // Animation digital
            digital(element, text, speed = 50, onComplete = null) {
                console.log('Digital called with:', { text, speed });
                this.text = text;
                this.options = { speed: speed, onComplete: onComplete };

                this.reset();
                element.style.color = '#00cc44';
                element.style.textShadow = '0 0 8px #00cc44';
                this.isRunning = true;
                this._digitalStep(element);
            }

            _digitalStep(element) {
                if (!this.isRunning) return;

                if (this.currentIndex < this.text.length) {
                    let displayText = this.text.substring(0, this.currentIndex);
                    const digitalChars = '01230456789ABCDEF<>{}[]()+-=*/\\|~^&%$#@!?';
                    displayText += digitalChars.charAt(Math.floor(Math.random() * digitalChars.length));

                    element.innerHTML = displayText;

                    setTimeout(() => {
                        this.currentIndex++;
                        if (this.currentIndex < this.text.length) {
                            this.timeoutId = setTimeout(() => this._digitalStep(element), this.options.speed);
                        } else {
                            element.innerHTML = this.text.replace(/\n/g, '<br>');
                            this.isRunning = false;
                            if (this.options.onComplete) this.options.onComplete();
                        }
                    }, this.options.speed / 2);
                }
            }
        }

        let textAnimator = new TextAnimationModule();

        function testTypewriter() {
            const msg = document.getElementById('message');
            const texte = 'üëÅÔ∏è‚ú® VOIR LA V√âRIT√â ‚ú®üëÅÔ∏è\n\nüåÖ CHAPITRE I ‚Äî LA LUMI√àRE\n\nüí≠ "Test de l\'animation typewriter..."';
            textAnimator.typewriter(msg, texte, 50, () => {
                console.log('Typewriter termin√©');
            });
        }

        function testFade() {
            const msg = document.getElementById('message');
            const texte = 'üåü Test Fade Animation\n\nCeci est un test d\'animation fade...';
            textAnimator.fadeIn(msg, texte, 1000, () => {
                console.log('Fade termin√©');
            });
        }

        function testDigital() {
            const msg = document.getElementById('message');
            const texte = 'üñ•Ô∏è Test Digital Animation\n\nCeci est un test d\'animation digital...';
            textAnimator.digital(msg, texte, 30, () => {
                console.log('Digital termin√©');
            });
        }
    </script>
</body>
</html>