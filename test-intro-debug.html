<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Intro Debug</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial;
            padding: 20px;
        }
        #status {
            border: 1px solid #64ffda;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        #message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            border: 2px solid #64ffda;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <h1>üîß Test Intro Debug</h1>

    <div id="status">
        <div>Status: <span id="statusText">Initialisation...</span></div>
        <div>Phase Intro Active: <span id="phaseActive">-</span></div>
        <div>Phase Intro Etape: <span id="phaseEtape">-</span></div>
        <div>Jeu Actif: <span id="jeuActif">-</span></div>
        <div>Narration Manager: <span id="narrationStatus">-</span></div>
    </div>

    <div id="message"></div>

    <button onclick="testIntro()">Test Intro Manuelle</button>
    <button onclick="testNarration()">Test Narration Directe</button>

    <script>
        // Variables de base
        let phaseIntro = { active: true, etape: 'arrivee_bateau', tempsDebut: Date.now() };
        let jeu = false;
        let narrationManager = null;

        // Simuler le TextAnimator
        class TextAnimator {
            constructor(elementId) {
                this.element = document.getElementById(elementId);
            }
            emboss(text, options = {}) {
                console.log('TextAnimator.emboss appel√©:', text);
                this.element.innerHTML = text.replace(/\n/g, '<br>');
                this.element.style.display = 'block';
                if (options.onComplete) {
                    setTimeout(options.onComplete, 1000);
                }
            }
        }

        // Simuler le NarrationManager
        class NarrationManager {
            constructor() {
                this.currentPhase = 1;
                this.isTransitioning = false;
            }

            reset() {
                this.currentPhase = 1;
                this.isTransitioning = false;
                console.log('[NARRATION] Reset');
            }

            start() {
                console.log('[NARRATION] Start appel√©');
                this.executeCurrentPhase();
            }

            getCurrentPhase() {
                const phases = [
                    {
                        id: 'VDV_NARR_P01_INTRO_LUMIERE',
                        phase: 1,
                        titre: 'CHAPITRE I ‚Äî LA LUMI√àRE',
                        texte: 'üí≠ "On m\'a dit qu\'ils √©taient tous des monstres...\nOn m\'a dit tant de mal, tant de malheurs sur eux...\nMais moi, j\'ai pr√©f√©r√© aller voir de mes propres yeux.\nQui √©taient ces gens-l√† ?..."',
                        duree: 12000,
                        transition: 'emboss',
                        speed: 45
                    }
                ];
                return phases[this.currentPhase - 1];
            }

            executeCurrentPhase() {
                const phase = this.getCurrentPhase();
                if (!phase) return;

                console.log(`[NARRATION] Ex√©cution phase ${phase.phase}: ${phase.id}`);

                const texteAvecEtape = `üìñ √âTAPE ${phase.phase}/16 - ${phase.titre}\n\n${phase.texte}`;

                // Simuler afficherMessageAnime
                const anim = new TextAnimator('message');
                anim.emboss(texteAvecEtape, {
                    onComplete: () => {
                        console.log('[NARRATION] Animation termin√©e');
                        setTimeout(() => {
                            document.getElementById('message').style.display = 'none';
                        }, 2000);
                    }
                });
            }
        }

        // Initialiser
        narrationManager = new NarrationManager();

        // Fonction de test de la phase intro
        function gererPhaseIntro() {
            if (!phaseIntro.active) {
                document.getElementById('phaseActive').textContent = 'false';
                return;
            }

            document.getElementById('phaseActive').textContent = 'true';
            document.getElementById('phaseEtape').textContent = phaseIntro.etape;

            const tempsEcoule = Date.now() - phaseIntro.tempsDebut;

            if (phaseIntro.etape === 'arrivee_bateau') {
                document.getElementById('statusText').textContent = `Attente intro (${Math.floor(tempsEcoule)}ms)`;
                if (tempsEcoule >= 1000) {
                    console.log('[INTRO] D√©marrage du narrationManager');
                    if (narrationManager) {
                        narrationManager.start();
                    }
                    phaseIntro.etape = 'rafales';
                    phaseIntro.tempsDebut = Date.now();
                }
            } else if (phaseIntro.etape === 'rafales') {
                document.getElementById('statusText').textContent = `Phase rafales (${Math.floor(tempsEcoule)}ms)`;
                if (tempsEcoule >= 2000) {
                    phaseIntro.etape = 'apparition_balle';
                    phaseIntro.tempsDebut = Date.now();
                }
            } else if (phaseIntro.etape === 'apparition_balle') {
                document.getElementById('statusText').textContent = `Apparition balle (${Math.floor(tempsEcoule)}ms)`;
                if (tempsEcoule >= 1000) {
                    phaseIntro.active = false;
                    jeu = true;
                }
            }
        }

        function testIntro() {
            phaseIntro = { active: true, etape: 'arrivee_bateau', tempsDebut: Date.now() };
            jeu = false;
            narrationManager.reset();
            console.log('[TEST] Test intro lanc√©');
        }

        function testNarration() {
            narrationManager.start();
            console.log('[TEST] Test narration directe');
        }

        function updateStatus() {
            document.getElementById('jeuActif').textContent = jeu;
            document.getElementById('narrationStatus').textContent = narrationManager ? 'OK' : 'NULL';
            gererPhaseIntro();
        }

        // Boucle de mise √† jour
        setInterval(updateStatus, 100);

        console.log('[DEBUG] Page charg√©e, intro initialis√©e');
    </script>
</body>
</html>