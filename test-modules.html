<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test des Modules - Voir la V√©rit√©</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .test-header {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .test-result {
            margin: 5px 0;
            padding: 5px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }

        canvas {
            border: 1px solid #666;
            margin: 10px 0;
            background: #fff;
            width: 100%;
            max-width: 450px;
            height: auto;
            aspect-ratio: 9/16;
        }

        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover {
            background: #00ff00;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>üß™ TEST DES MODULES - VOIR LA V√âRIT√â</h1>

    <div class="test-section">
        <div class="test-header">üì¶ 1. CHARGEMENT DES MODULES</div>
        <div id="module-loading-tests"></div>
    </div>

    <div class="test-section">
        <div class="test-header">üé® 2. MODULES GRAPHIQUES</div>
        <canvas id="graphics-test-canvas" width="450" height="800"></canvas>
        <div>
            <button onclick="testBoatRenderer()">Test Bateau</button>
            <button onclick="testHeartRenderer()">Test C≈ìurs</button>
            <button onclick="testLanternRenderer()">Test Lanterne</button>
            <button onclick="testEnvironmentRenderer()">Test Environnement</button>
        </div>
        <div id="graphics-test-results"></div>
    </div>

    <div class="test-section">
        <div class="test-header">‚öôÔ∏è 3. SYST√àMES</div>
        <canvas id="systems-test-canvas" width="450" height="800"></canvas>
        <div>
            <button onclick="testParticleSystem()">Test Particules</button>
            <button onclick="clearParticles()">Clear Particules</button>
        </div>
        <div id="systems-test-results"></div>
    </div>

    <div class="test-section">
        <div class="test-header">üîß 4. CONFIGURATION</div>
        <div id="config-test-results"></div>
    </div>

    <div class="test-section">
        <div class="test-header">üìä 5. STATISTIQUES DES TESTS</div>
        <div id="test-stats"></div>
    </div>

    <script type="module">
        // Variables globales pour les tests
        let testResults = {
            passed: 0,
            failed: 0,
            warnings: 0,
            total: 0
        };

        let ModuleManager = null;
        let graphicsCtx = null;
        let systemsCtx = null;

        // Fonctions utilitaires de test
        function logTest(message, type = 'info') {
            console.log(`[TEST] ${message}`);
            testResults.total++;

            if (type === 'success') testResults.passed++;
            else if (type === 'error') testResults.failed++;
            else if (type === 'warning') testResults.warnings++;

            return `<div class="test-result ${type}">‚úì ${message}</div>`;
        }

        function logError(message) {
            console.error(`[ERROR] ${message}`);
            testResults.total++;
            testResults.failed++;
            return `<div class="test-result error">‚úó ${message}</div>`;
        }

        function updateStats() {
            document.getElementById('test-stats').innerHTML = `
                <div class="success">‚úì R√©ussis: ${testResults.passed}</div>
                <div class="error">‚úó √âchecs: ${testResults.failed}</div>
                <div class="warning">‚ö† Warnings: ${testResults.warnings}</div>
                <div class="info">üìä Total: ${testResults.total}</div>
            `;
        }

        // Test 1: Chargement des modules
        async function testModuleLoading() {
            const resultsDiv = document.getElementById('module-loading-tests');
            let results = '';

            try {
                // Test d'import du gestionnaire principal (avec cache-busting)
                const timestamp = Date.now();
                const moduleImport = await import(`./modules/index.js?v=${timestamp}`);
                ModuleManager = moduleImport.default;
                results += logTest('Gestionnaire principal charg√©', 'success');

                // Test de disponibilit√© des modules graphiques
                if (ModuleManager.isAvailable('graphics', 'boat')) {
                    results += logTest('BoatRenderer disponible', 'success');
                } else {
                    results += logError('BoatRenderer manquant');
                }

                if (ModuleManager.isAvailable('graphics', 'heart')) {
                    results += logTest('HeartRenderer disponible', 'success');
                } else {
                    results += logError('HeartRenderer manquant');
                }

                if (ModuleManager.isAvailable('graphics', 'lantern')) {
                    results += logTest('LanternRenderer disponible', 'success');
                } else {
                    results += logError('LanternRenderer manquant');
                }

                if (ModuleManager.isAvailable('graphics', 'environment')) {
                    results += logTest('EnvironmentRenderer disponible', 'success');
                } else {
                    results += logError('EnvironmentRenderer manquant');
                }

                // Test des syst√®mes
                if (ModuleManager.isAvailable('systems', 'particles')) {
                    results += logTest('ParticleSystem disponible', 'success');
                } else {
                    results += logError('ParticleSystem manquant');
                }

                // Test de la configuration
                if (ModuleManager.config) {
                    results += logTest('GameConfig charg√©', 'success');
                } else {
                    results += logError('GameConfig manquant');
                }

                // Statistiques du gestionnaire
                const stats = ModuleManager.getStats();
                results += logTest(`Modules graphiques: ${stats.graphics}`, 'info');
                results += logTest(`Syst√®mes: ${stats.systems}`, 'info');

            } catch (error) {
                results += logError(`Erreur de chargement: ${error.message}`);
            }

            resultsDiv.innerHTML = results;
            updateStats();
        }

        // Test 2: Configuration
        function testGameConfig() {
            const resultsDiv = document.getElementById('config-test-results');
            let results = '';

            if (!ModuleManager || !ModuleManager.config) {
                results += logError('Configuration non disponible');
                resultsDiv.innerHTML = results;
                return;
            }

            const config = ModuleManager.config;

            // Test des chapitres
            if (config.CHAPITRE1 && Array.isArray(config.CHAPITRE1)) {
                results += logTest(`CHAPITRE1 d√©fini (${config.CHAPITRE1.length} √©l√©ments)`, 'success');
            } else {
                results += logError('CHAPITRE1 manquant ou invalide');
            }

            if (config.CHAPITRE2 && Array.isArray(config.CHAPITRE2)) {
                results += logTest(`CHAPITRE2 d√©fini (${config.CHAPITRE2.length} √©l√©ments)`, 'success');
            } else {
                results += logError('CHAPITRE2 manquant ou invalide');
            }

            // Test des couleurs
            if (config.COLORS && config.COLORS.HEART_COLORS) {
                results += logTest(`Couleurs de c≈ìurs d√©finies (${config.COLORS.HEART_COLORS.length})`, 'success');
            } else {
                results += logError('Couleurs de c≈ìurs manquantes');
            }

            // Test du gameplay
            if (config.GAMEPLAY && config.GAMEPLAY.VIES_INITIALES) {
                results += logTest(`Param√®tres de gameplay d√©finis`, 'success');
            } else {
                results += logError('Param√®tres de gameplay manquants');
            }

            // Test des calculs responsifs
            if (config.RESPONSIVE && typeof config.RESPONSIVE.calculateConstants === 'function') {
                const constants = config.RESPONSIVE.calculateConstants(450, 800);
                if (constants.W && constants.H && constants.PW && constants.PH) {
                    results += logTest('Calculs responsifs fonctionnels', 'success');
                } else {
                    results += logError('Calculs responsifs d√©faillants');
                }
            } else {
                results += logError('Fonction calculateConstants manquante');
            }

            resultsDiv.innerHTML = results;
            updateStats();
        }

        // Fonctions de test des modules graphiques (accessibles globalement)
        window.testBoatRenderer = function() {
            const resultsDiv = document.getElementById('graphics-test-results');

            if (!ModuleManager || !ModuleManager.graphics.boat) {
                resultsDiv.innerHTML = logError('BoatRenderer non disponible');
                return;
            }

            try {
                const canvas = document.getElementById('graphics-test-canvas');
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Configuration de test
                const C = { PW: 80, PH: 20 };
                const raquette = { x: 100, y: 200 };

                // Test bateau normal
                ModuleManager.graphics.boat.render(ctx, raquette, C, false);

                // Test bateau militaire
                const raquette2 = { x: 300, y: 200 };
                ModuleManager.graphics.boat.render(ctx, raquette2, C, true);

                resultsDiv.innerHTML = logTest('BoatRenderer test√© avec succ√®s (normal + militaire)', 'success');

            } catch (error) {
                resultsDiv.innerHTML = logError(`Erreur BoatRenderer: ${error.message}`);
            }
            updateStats();
        };

        window.testHeartRenderer = function() {
            const resultsDiv = document.getElementById('graphics-test-results');

            if (!ModuleManager || !ModuleManager.graphics.heart) {
                resultsDiv.innerHTML = logError('HeartRenderer non disponible');
                return;
            }

            try {
                const canvas = document.getElementById('graphics-test-canvas');
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Test diff√©rents types de c≈ìurs
                ModuleManager.graphics.heart.drawPixelHeart(ctx, 100, 100, 30, '#ff6b6b');
                ModuleManager.graphics.heart.drawPolygonalHeart(ctx, 200, 100, 25, '#4ecdc4');
                ModuleManager.graphics.heart.drawSmallHeart(ctx, 300, 100, 15, '#45b7d1');

                // Test positions en forme de c≈ìur
                const positions = ModuleManager.graphics.heart.generateHeartPositions(
                    8, 20, 15, 5, 50, 450, 800
                );

                positions.forEach((pos, i) => {
                    const color = ModuleManager.config.COLORS.HEART_COLORS[i % ModuleManager.config.COLORS.HEART_COLORS.length];
                    ModuleManager.graphics.heart.drawSmallHeart(ctx, pos.x, pos.y, 8, color);
                });

                resultsDiv.innerHTML = logTest(`HeartRenderer test√© avec succ√®s (3 types + ${positions.length} positions)`, 'success');

            } catch (error) {
                resultsDiv.innerHTML = logError(`Erreur HeartRenderer: ${error.message}`);
            }
            updateStats();
        };

        window.testLanternRenderer = function() {
            const resultsDiv = document.getElementById('graphics-test-results');

            if (!ModuleManager || !ModuleManager.graphics.lantern) {
                resultsDiv.innerHTML = logError('LanternRenderer non disponible');
                return;
            }

            try {
                const canvas = document.getElementById('graphics-test-canvas');
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const C = { BS: 20 };
                const balle1 = { x: 150, y: 200, visible: true };
                const balle2 = { x: 350, y: 200, visible: true };

                // Test lanterne allum√©e
                const lanterne1 = { active: true, intensite: 1 };
                ModuleManager.graphics.lantern.render(ctx, balle1, lanterne1, C, false, 'jeu_briques');

                // Test lanterne √©teinte
                const lanterne2 = { active: false, intensite: 0 };
                ModuleManager.graphics.lantern.render(ctx, balle2, lanterne2, C, false, 'jeu_briques');

                resultsDiv.innerHTML = logTest('LanternRenderer test√© avec succ√®s (allum√©e + √©teinte)', 'success');

            } catch (error) {
                resultsDiv.innerHTML = logError(`Erreur LanternRenderer: ${error.message}`);
            }
            updateStats();
        };

        window.testEnvironmentRenderer = function() {
            const resultsDiv = document.getElementById('graphics-test-results');

            if (!ModuleManager || !ModuleManager.graphics.environment) {
                resultsDiv.innerHTML = logError('EnvironmentRenderer non disponible');
                return;
            }

            try {
                const canvas = document.getElementById('graphics-test-canvas');
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const C = { W: 450, H: 800 };
                const VOYAGE = ModuleManager.config.CHAPITRE1;
                const soleil = { clignotement: false, tempsClignotement: 0 };

                // Test chapitre 1 (jour)
                ModuleManager.graphics.environment.drawSky(ctx, C, 1, 5, VOYAGE, soleil, false);
                ModuleManager.graphics.environment.drawSea(ctx, C, 1);

                resultsDiv.innerHTML = logTest('EnvironmentRenderer test√© avec succ√®s (ciel + mer chapitre 1)', 'success');

            } catch (error) {
                resultsDiv.innerHTML = logError(`Erreur EnvironmentRenderer: ${error.message}`);
            }
            updateStats();
        };

        // Test du syst√®me de particules
        window.testParticleSystem = function() {
            const resultsDiv = document.getElementById('systems-test-results');

            if (!ModuleManager || !ModuleManager.systems.particles) {
                resultsDiv.innerHTML = logError('ParticleSystem non disponible');
                return;
            }

            try {
                const canvas = document.getElementById('systems-test-canvas');
                systemsCtx = canvas.getContext('2d');

                // Test ajout de particules
                ModuleManager.systems.particles.addParticles(150, 150, '#ff6b6b', 10);
                ModuleManager.systems.particles.addHeartParticles(300, 150, '#4ecdc4', 8);
                ModuleManager.systems.particles.createFireworks(450, 150, '#45b7d1', 12);

                // D√©marrer l'animation des particules
                startParticleAnimation();

                resultsDiv.innerHTML = logTest('ParticleSystem test√© avec succ√®s (3 types de particules)', 'success');

            } catch (error) {
                resultsDiv.innerHTML = logError(`Erreur ParticleSystem: ${error.message}`);
            }
            updateStats();
        };

        window.clearParticles = function() {
            if (ModuleManager && ModuleManager.systems.particles) {
                ModuleManager.systems.particles.clear();
                const canvas = document.getElementById('systems-test-canvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        };

        // Animation des particules
        function startParticleAnimation() {
            if (!systemsCtx || !ModuleManager) return;

            const canvas = document.getElementById('systems-test-canvas');
            systemsCtx.clearRect(0, 0, canvas.width, canvas.height);

            // Mettre √† jour et dessiner les particules
            ModuleManager.systems.particles.update(false);
            ModuleManager.systems.particles.render(systemsCtx, false);

            requestAnimationFrame(startParticleAnimation);
        }

        // Initialisation des tests
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üß™ D√©marrage des tests des modules');

            // Test 1: Chargement des modules
            await testModuleLoading();

            // Test 2: Configuration
            testGameConfig();

            // Configuration initiale des canvas
            graphicsCtx = document.getElementById('graphics-test-canvas').getContext('2d');
            systemsCtx = document.getElementById('systems-test-canvas').getContext('2d');

            console.log('‚úÖ Tests initialis√©s');
        });
    </script>
</body>
</html>